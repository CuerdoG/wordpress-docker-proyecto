# PUERTO 80: Redirige a HTTPS manteniendo el Host (IP o Dominio)
<VirtualHost *:80>
    ServerAdmin webmaster@zitadel.es
    
    # Esta línea es la clave: redirige a la misma dirección pero con https
    # sin importar si es la IP o el dominio
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

# PUERTO 443: Configuración SSL
<VirtualHost *:443>
    # Quitamos ServerName fijo para que acepte peticiones por IP también
    ServerAdmin webmaster@zitadel.es
    DocumentRoot /var/www/html

    SSLEngine on
    # Asegúrate de que estos nombres coincidan con tus archivos en ./apache2/certs
    SSLCertificateFile /etc/apache2/ssl/server.crt
    SSLCertificateKeyFile /etc/apache2/ssl/server.key

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
